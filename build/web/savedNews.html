<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Html.html to edit this template
-->
<html>
    <head>
        <title>Saved News</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Merriweather&family=Montserrat&family=Open+Sans&family=Roboto+Condensed&display=swap');

            *{
                color: white;
                margin: 0;
                padding: 0;
            }
            body {
                font-family: "Roboto Condensed", sans-serif;
                font-weight: 400;
                font-style: normal;
                background-color: #f0f0f0;
            }
            .header {
                background-color: blueviolet;
                border-bottom: 2px solid black;
                display: flex;
                justify-content: space-between;
                align-items: baseline;
            }
            .logo {
                padding: 20px 15px;
                font-size: 40px;
                text-decoration: none;
                font-family: "Bebas Neue", sans-serif;
                font-weight: 400;
                font-style: normal;
                text-shadow: 2px 2px 2px black;
                color: white;
            }
            #logo {
                display: flex;
                justify-content: center;
                align-items: center;
            }
            #home,#mode{
                color: white;
                font-size: 24px;
                margin: 15px;
            }
            body::-webkit-scrollbar {
                display: none;
            }
            @media (min-width:768px) {
                .card {
                    width: 360px;
                }
                .button{
                    font-size: large
                }
                #enable,#enable-icon{
                    font-size: large;
                }
                .card-checkbox{
                    width: 20px;
                    height: 20px;
                }
            }

            @media (max-width: 768px) {
                .card {
                    width: 300px;
                }
                .button{
                    padding: 5px;
                    font-size: medium
                }
                #enable,#enable-icon{
                    font-size: medium;
                }
            }

            @media (max-width: 425px){
                .logo{
                    font-size: 30px;
                    padding: 15px 10px;
                }
                #home,#mode{
                    font-size: 16px;
                }
                .card{
                    width: 360px;
                }
                .button{
                    font-size: small;
                }
                .card-checkbox{
                    width: 10px;
                    height: 10px;
                }
            }

            main {
                padding: 20px;
            }

            .cards-container {
                display: flex;
                flex-direction: column;
                justify-content: space-evenly;
                column-gap: 15px;
                row-gap: 30px;
            }

            .card {
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                border: 2px solid blueviolet;
                min-height: 450px;
                box-shadow: 0 0 8px black;
                border-radius: 4px;
                cursor: pointer;
                background-color: #fff;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .card:hover {
                box-shadow: 1px 1px 8px #d4ecff;
                background-color: #f9fdff;
                transform: translateY(-2px);
            }

            .card-header {
                margin-bottom: -4px;
                position: relative;
            }

            .card-header img {
                width: 100%;
                height: 180px;
                object-fit: cover;
                border-bottom: 2px solid blueviolet;
            }

            .news-source {
                font-family: "Montserrat", sans-serif;
                font-weight: 400;
                font-style: normal;
                color: white;
                padding: 4px 12px;
                background-color: blueviolet;
                margin: 0;
            }

            #news-title {
                padding: 12px;
                color: black;
                font-family: "Merriweather", serif;
                font-weight: 400;
                font-style: normal;
            }

            #cards-main {
                padding-top: 10px;
            }

            .news-desc {
                color: black;
                padding: 12px;
                padding-top: 0px;
                text-overflow: ellipsis;
                font-family: "Open Sans", sans-serif;
                font-weight: 400;
                font-style: normal;
            }
            .flex{
                display: flex;
                justify-content: space-between;
                align-items: center;
                background-color: blueviolet;
                padding: 8px 10px;
                margin: 0;
            }

            .delete-news{
                color: white;
                font-size: 20px;
            }

            .saved-news{
                display: none;
                color: white;
                font-size: 20px;
            }

            .notification {
                display: none;
                position: fixed;
                top: 10px;
                right: 10px;
                color: white;
                background-color: blueviolet;
                padding: 15px;
                border-radius: 5px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                z-index: 1000;
                font-family: "Lato", sans-serif;
                font-weight: 400;
                font-style: normal;
            }

            #social-sharing{
                display: flex;
                justify-content: space-evenly;
                align-items: center;
                background-color: blueviolet;
                padding: 8px 0;
            }

            .fa-brands,.fa-comment,.fa-copy{
                color: white;
                font-size: 22px;
            }

            .date-section {
                margin-bottom: 20px;
                display: flex;
                flex-direction: row;
                overflow: hidden;
                flex-wrap: wrap;
                column-gap: 15px;
                row-gap: 30px;
                align-items: start;
                justify-content: space-evenly;
            }

            .date-div{
                display: flex;
                justify-content: space-between;
                width: 100%;
                background-color: blueviolet;
                align-items: center;
            }

            .date {
                font-size: large;
                color: white;
                padding: 5px;
            }


            .fa-trash{
                font-size: medium;
            }

            .delete-date{
                color: white;
                font-size: larger;
                padding: 5px;
            }

            #title{
                display: flex;
                justify-content: space-between;
                align-items: center;
                background-color: darkviolet;
                color: white;
                padding: 10px 15px;
                border-bottom: 2px solid black;
            }

            #enable-div{
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            #enable-icon{
                margin-left: 5px;
            }

            .button{
                padding: 5px 10px;
                border: 1px solid black;
                color: white;
                background-color: blueviolet;
                border-radius: 5px;
                box-shadow: 0px 0px 4px black;
            }

            #delete-selected{
                display: none;
            }

            .card-checkbox {
                position: absolute;
                top: 10px;
                left: 10px;
                z-index: 10;
                display: none;
            }

        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
              integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
              crossorigin="anonymous" referrerpolicy="no-referrer" />
    </head>
    <body>
        <header class="header">
            <div>
                <a href="index.html"><i class="fa-solid fa-house" id="home"></i></a>
            </div>
            <div id="logo">
                <div class="logo">THE NOBLE NEWS</div>
            </div>
            <div>
                <i class="fa-solid fa-sun" id="mode"></i>
            </div>
        </header>
        <div id="title">
            <div id="enable-div">                
                <span id="enable">Enable Multi-Delete</span>
                <i id="enable-icon" class="fa-solid fa-toggle-off"></i>
            </div>
            <div id="delete-button">
                <button class="button" id="delete-all">Delete All</button>
                <button class="button" id="delete-selected">Delete Selected</button>
            </div>
        </div>
        <main id="cards-main">
            <div class="cards-container" id="cards-container">
            </div>
        </main>
        <template id="template-news-card">
            <div class="card">
                <div>
                    <div class="card-header">
                        <img src="https://via.placeholder.com/400x200" alt="news-image" onerror="this.src='alt-image.webp';"
                             id="news-img">
                        <input type="checkbox" class="card-checkbox" >
                    </div>
                    <div> 
                        <div class="flex">
                            <h6 class="news-source" id="news-source">End Gadget 26/08/2023</h6><i class="saved-news fa-solid fa-trash"></i>
                        </div>
                        <h3 id="news-title">This is the Title</h3>
                        <p class="news-desc" id="news-desc">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Recusandae
                            saepe quis voluptatum quisquam vitae doloremque facilis molestias quae ratione cumque!</p>
                    </div>
                </div>
                <div id="social-sharing">
                    <i class="fa-brands fa-whatsapp" onclick="shareOnWhatsApp()"></i>
                    <i class="fa-brands fa-facebook" onclick="shareOnFacebook()"></i>
                    <i class="fa-brands fa-x-twitter" onclick="shareOnTwitter()"></i>
                    <i class="fa-solid fa-copy"></i>
                    <i class="fa-solid fa-comment" onclick="Comments(this)"></i>
                </div>
            </div>
        </template>
        <div id="notification" class="notification"></div>
        <script>
            const Enable = document.getElementById("enable-div");
            const enableIcon = document.getElementById("enable-icon");
            const DeleteAll = document.getElementById("delete-all");
            const DeleteSelected = document.getElementById("delete-selected");

            Enable.addEventListener("click", function () {
                if (enableIcon.classList.contains("fa-toggle-off")) {
                    enableIcon.classList.remove("fa-toggle-off");
                    enableIcon.classList.add("fa-toggle-on");
                    DeleteAll.style.display = "none";
                    DeleteSelected.style.display = "block";
                    const checkboxes = document.querySelectorAll(".card-checkbox");
                    checkboxes.forEach(checkbox => {
                        checkbox.style.display = "block";
                    });
                } else {
                    enableIcon.classList.remove("fa-toggle-on");
                    enableIcon.classList.add("fa-toggle-off");
                    DeleteSelected.style.display = "none";
                    const checkboxes = document.querySelectorAll(".card-checkbox");
                    checkboxes.forEach(checkbox => {
                        checkbox.style.display = "none";
                    });
                    DeleteAll.style.display = "block";
                }
            });

            window.addEventListener('load', function () {
                const email = localStorage.getItem('email');
                fetch(`/The_Noble_News/NewsServlet?email=${email}`)
                        .then(response => response.json())
                        .then(data => {
                            const cardsContainer = document.getElementById('cards-container');
                            const template = document.getElementById('template-news-card').content;

                            data.sort((a, b) => new Date(b.savedDate) - new Date(a.savedDate));

                            const groupedNews = data.reduce((acc, newsItem) => {
                                const savedDate = new Date(newsItem.savedDate);
                                const dateStringForDeletion = savedDate.toISOString().split('T')[0];
                                const day = String(savedDate.getDate()).padStart(2, '0');
                                const month = String(savedDate.getMonth() + 1).padStart(2, '0');
                                const year = savedDate.getFullYear();
                                const dateStringForDisplay = `${day}-${month}-${year}`;

                                if (!acc[dateStringForDeletion]) {
                                    acc[dateStringForDeletion] = {
                                        displayDate: dateStringForDisplay,
                                        newsItems: []
                                    };
                                }
                                acc[dateStringForDeletion].newsItems.push(newsItem);
                                return acc;
                            }, {});

                            cardsContainer.innerHTML = '';

                            for (const [date, groupedNewsItems] of Object.entries(groupedNews)) {
                                const dateDiv = document.createElement('div');
                                dateDiv.innerText = groupedNewsItems.displayDate;
                                dateDiv.classList.add('date');

                                const deleteDate = document.createElement('i');
                                deleteDate.classList.add('delete-date', 'fa-solid', 'fa-trash');

                                const dateContainer = document.createElement('div');
                                dateContainer.classList.add('date-div');
                                dateContainer.appendChild(dateDiv);
                                dateContainer.appendChild(deleteDate);
                                cardsContainer.appendChild(dateContainer);

                                const dateSection = document.createElement('div');
                                dateSection.classList.add('date-section');

                                groupedNewsItems.newsItems.forEach(newsItem => {
                                    const card = document.importNode(template, true);
                                    const img = card.querySelector('#news-img');
                                    const title = card.querySelector('#news-title');
                                    const source = card.querySelector('#news-source');
                                    const desc = card.querySelector('#news-desc');
                                    const deleteButton = card.querySelector('.saved-news');
                                    const copyButton = card.querySelector('.fa-copy');

                                    img.src = newsItem.img;
                                    title.textContent = newsItem.title;
                                    desc.textContent = newsItem.desc;
                                    source.textContent = `Source: ${newsItem.source}`;

                                    const cardElement = card.querySelector('.card');
                                    cardElement.setAttribute('data-url', newsItem.url);

                                    [img, title, source, desc].forEach(element => {
                                        element.addEventListener('click', () => {
                                            window.open(newsItem.url, '_blank');
                                            history(email, title.textContent, newsItem.url, img.src, source.textContent, desc.textContent);
                                        });
                                    });

                                    if (copyButton) {
                                        copyButton.addEventListener('click', function () {
                                            const card = this.closest('.card');
                                            const url = card.getAttribute('data-url');

                                            if (url) {
                                                navigator.clipboard.writeText(url).then(() => {
                                                    showNotification('URL copied to clipboard!');
                                                }).catch(err => {
                                                    console.error('Failed to copy the URL: ', err);
                                                });
                                            }
                                        });
                                    }

                                    deleteButton.addEventListener('click', () => {
                                        deleteNews(newsItem.url, email);
                                    });

                                    dateSection.appendChild(card);
                                });

                                cardsContainer.appendChild(dateSection);
                                const mode = localStorage.getItem("Mode");
                                if (mode === "true") {
                                    change(true);
                                } else {
                                    change(false);
                                }
                                deleteDate.addEventListener('click', () => {
                                    deleteNewsByDate(date, email);
                                });
                            }
                        })
                        .catch(error => console.error('Error fetching saved news:', error));
            });

            function deleteNews(url, email) {
                if (confirm('Are you sure you want to delete this news?')) {
                    fetch(`/The_Noble_News/NewsServlet`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({url, email})
                    })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    window.location.reload();
                                }
                            })
                            .catch(() => {
                                alert('Error occurred while deleting news.');
                            });
                }
            }

            function deleteNewsByDate(date, email) {
                if (confirm(`Are you sure you want to delete all news for ${date}?`)) {
                    fetch(`/The_Noble_News/NewsServlet`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({savedDate: date, email})
                    })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    window.location.reload();
                                }
                            })
                            .catch(() => {
                                alert('Error occurred while deleting news.');
                            });
                }
            }

            document.getElementById('delete-all').addEventListener('click', () => {
                const email = localStorage.getItem('email');
                if (confirm('Are you sure you want to delete all saved news?')) {
                    fetch(`/The_Noble_News/NewsServlet`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({email})
                    })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    window.location.reload();
                                }
                            })
                            .catch(() => {
                                alert('Error occurred while deleting all news.');
                            });
                }
            });

            document.getElementById('delete-selected').addEventListener('click', () => {
                const checkboxes = document.querySelectorAll('.card-checkbox');
                const selectedNews = [];
                const email = localStorage.getItem('email');

                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const newsCard = checkbox.closest('.card');
                        const url = newsCard.getAttribute('data-url');

                        selectedNews.push({url, email});
                    }
                });

                if (selectedNews.length === 0) {
                    alert('Select news to delete');
                    return;
                }

                if (confirm('Are you sure you want to delete the selected news?')) {
                    fetch(`/The_Noble_News/BulkDelete`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(selectedNews)
                    })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    window.location.reload();
                                } else {
                                    alert('Failed to delete selected news.');
                                }
                            })
                            .catch(() => {
                                alert('Error occurred while deleting news.');
                            });
                }
            });

            function showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification`;
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }

            const Mode = document.getElementById("mode");
            Mode.addEventListener("click", function () {
                if (Mode.classList.contains("fa-sun")) {
                    localStorage.setItem("Mode", true);
                    change(true);
                } else {
                    localStorage.setItem("Mode", false);
                    change(false);
                }
            });

            function change(element) {
                if (element === true) {
                    Mode.classList.remove("fa-sun");
                    Mode.classList.add("fa-moon");
                    document.querySelector("body").style.backgroundColor = "#454545";
                    let cards = document.querySelectorAll('.card');
                    cards.forEach(card => {
                        card.style.backgroundColor = '#454545';
                    });
                    let titles = document.querySelectorAll("#news-title");
                    let descs = document.querySelectorAll(".news-desc");
                    changeColor([...titles, ...descs], 'white');
                } else {
                    Mode.classList.remove("fa-moon");
                    Mode.classList.add("fa-sun");
                    document.querySelector("body").style.backgroundColor = "#f0f0f0";
                    let cards = document.querySelectorAll('.card');
                    cards.forEach(card => {
                        card.style.backgroundColor = '#fff';
                    });
                    let titles = document.querySelectorAll("#news-title");
                    let descs = document.querySelectorAll(".news-desc");
                    changeColor([...titles, ...descs], 'black');
                }
            }

            function changeColor(elements, color) {
                elements.forEach(element => {
                    element.style.color = color;
                });
            }

            function shareOnWhatsApp() {
                const newsTitle = document.getElementById('news-title').innerText;
                const newsUrl = window.location.href;
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(newsTitle)} - ${encodeURIComponent(newsUrl)}`;
                window.open(whatsappUrl, '_blank');
            }

            function shareOnFacebook() {
                const newsTitle = document.getElementById('news-title').innerText;
                const newsUrl = window.location.href;
                const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(newsUrl)}&quote=${encodeURIComponent(newsTitle)}`;
                window.open(facebookUrl, '_blank');
            }

            function shareOnTwitter() {
                const newsTitle = document.getElementById('news-title').innerText;
                const newsUrl = window.location.href;
                const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(newsTitle)}&url=${encodeURIComponent(newsUrl)}`;
                window.open(twitterUrl, '_blank');
            }

            function Comments(commentIcon) {
                const card = commentIcon.closest('.card');
                const imgSrc = card.querySelector('#news-img').src;
                const title = card.querySelector('#news-title').textContent;
                const source = card.querySelector('#news-source').textContent;
                const description = card.querySelector('#news-desc').textContent;
                const url = card.getAttribute('data-url');
                const email = localStorage.getItem('email');
                const commentPageData = {
                    imgSrc: imgSrc,
                    title: title,
                    source: source,
                    description: description,
                    url: url,
                    email: email
                };
                localStorage.setItem('commentPageData', JSON.stringify(commentPageData));
                window.location.href = 'Comments.html';
            }

            function history(element1, element2, element3, element4, element5, element6) {
                fetch(`http://localhost:8080/The_Noble_News/HistoryServlet?email=${element1}&title=${encodeURIComponent(element2)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                        .then(response => response.json())
                        .then(data => {
                            if (!data.exists) {
                                fetch('http://localhost:8080/The_Noble_News/HistoryServlet', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        email: element1,
                                        title: element2,
                                        url: element3,
                                        imageUrl: element4,
                                        source: element5,
                                        description: element6
                                    })
                                });
                            }
                        })
                        .catch(error => {
                            console.log(error);
                        });
            }

        </script>
    </body>
</html>
